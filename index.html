<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Tree - Ibrahim Family</title>
    <styles> * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #006677, #004455);
    min-height: 100vh;
    color: #333;
}

.page {
    min-height: 100vh;
    padding: 20px;
}

.hidden {
    display: none !important;
}

/* Login Page */
.login-container {
    background: white;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 10px 30px slategray;
    max-width: 400px;
    margin: 100px auto;
    text-align: center;
}

.login-container h2 {
    color: #006677;
    margin-bottom: 30px;
}

.login-container input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s;
}

.login-container input:focus {
    border-color: #006677;
    outline: none;
}

.login-container button {
    width: 100%;
    padding: 12px;
    background: #006677;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    margin: 10px 0;
    transition: background 0.3s;
}

.login-container button:hover {
    background: #004455;
}

.public-view {
    margin-top: 20px;
    color: #666;
}

.public-view a {
    color: #006677;
    text-decoration: none;
}

.public-view a:hover {
    text-decoration: underline;
}

/* Header */
header {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 15px slategray;
    margin-bottom: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

header h1 {
    color: #006677;
}

.logout-btn, .admin-btn {
    background: #006677;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
}

.logout-btn:hover, .admin-btn:hover {
    background: #004455;
}

/* Admin Controls */
.admin-controls {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 15px slategray;
    margin-bottom: 25px;
}

.admin-controls h3 {
    color: #006677;
    margin-bottom: 20px;
}

.input-group {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr auto;
    gap: 15px;
    align-items: end;
}

.input-group input, .input-group select {
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
}

.input-group input:focus, .input-group select:focus {
    border-color: #006677;
    outline: none;
}

.input-group button {
    background: #006677;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s;
}

.input-group button:hover {
    background: #004455;
}

/* Export/Import */
.export-import {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 15px slategray;
    margin-bottom: 25px;
    display: flex;
    gap: 15px;
    align-items: center;
}

.export-import button {
    background: #006677;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
}

.export-import button:hover {
    background: #004455;
}

#importFile {
    display: none;
}

/* Members List */
.members-list {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 15px slategray;
}

.members-list h3 {
    color: #006677;
    margin-bottom: 20px;
}

.member-card {
    background: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    margin: 10px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: transform 0.2s;
}

.member-card:hover {
    transform: translateY(-2px);
    border-color: #006677;
}

.member-info h4 {
    color: #006677;
    margin-bottom: 5px;
}

.member-info p {
    color: #666;
    font-size: 14px;
}

.member-actions button {
    background: #dc3545;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    margin-left: 10px;
    transition: background 0.3s;
}

.member-actions button.edit-btn {
    background: #ffc107;
    color: #333;
}

.member-actions button:hover {
    opacity: 0.9;
}

/* Family Tree Visualization */
.family-tree {
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 30px slategray;
}

.tree-container {
    overflow-x: auto;
    padding: 20px 0;
}

.tree-horizontal {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 40px;
    min-height: 300px;
    position: relative;
}

.ancestor-box {
    background: #006677;
    color: white;
    padding: 25px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 8px 25px slategray;
    border: 3px solid #004455;
    min-width: 200px;
    position: relative;
    z-index: 2;
}

.ancestor-box h3 {
    font-size: 18px;
    margin-bottom: 8px;
}

.ancestor-box .role {
    font-style: italic;
    opacity: 0.9;
    margin-bottom: 5px;
}

.ancestor-box .nickname {
    font-weight: bold;
    background: rgba(255,255,255,0.2);
    padding: 4px 8px;
    border-radius: 4px;
    display: inline-block;
}

.member-box {
    background: white;
    border: 2px solid #006677;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    min-width: 180px;
    position: relative;
    z-index: 1;
}

.member-box h4 {
    color: #006677;
    margin-bottom: 6px;
    font-size: 16px;
}

.member-box .role {
    color: #666;
    font-style: italic;
    margin-bottom: 5px;
    font-size: 14px;
}

.member-box .nickname {
    background: #006677;
    color: white;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 12px;
    display: inline-block;
}

/* Responsive Design */
@media (max-width: 768px) {
    .input-group {
        grid-template-columns: 1fr;
    }
    
    header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .tree-horizontal {
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }
    
    .login-container {
        margin: 50px 20px;
        padding: 30px 20px;
    }
}</styles>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyDCjeloG-2RrirnwY9eiYaKez090exCdZc",
            authDomain: "my-family-tree-16886.firebaseapp.com",
            projectId: "my-family-tree-16886",
            storageBucket: "my-family-tree-16886.firebasestorage.app",
            messagingSenderId: "400708543065",
            appId: "1:400708543065:web:b401629e83ca6f9e780748"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        window.firebaseApp = app;
        window.db = db;
        window.getDocs = getDocs;
        window.addDoc = addDoc;
        window.collection = collection;
        window.deleteDoc = deleteDoc;
        window.doc = doc;
        window.onSnapshot = onSnapshot;
    </script>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="page">
        <div class="login-container">
            <h2>Admin Login</h2>
            <input type="text" id="username" placeholder="Username" value="Benalee">
            <input type="password" id="password" placeholder="Password" value="Ab@58563">
            <button onclick="login()">Login</button>
            <p class="public-view">Just here to view? <a href="#" onclick="showPublicView()">View Family Tree</a></p>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="page hidden">
        <header>
            <h1>Ibrahim Family Tree - Admin</h1>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </header>
        
        <div class="admin-controls">
            <h3>Add Family Member</h3>
            <div class="input-group">
                <input type="text" id="memberName" placeholder="Full Name">
                <input type="text" id="memberNickname" placeholder="Nickname">
                <select id="memberRole">
                    <option value="father">Father</option>
                    <option value="mother">Mother</option>
                    <option value="son">Son</option>
                    <option value="daughter">Daughter</option>
                    <option value="brother">Brother</option>
                    <option value="sister">Sister</option>
                    <option value="grandfather">Grandfather</option>
                    <option value="grandmother">Grandmother</option>
                    <option value="uncle">Uncle</option>
                    <option value="aunt">Aunt</option>
                    <option value="cousin">Cousin</option>
                </select>
                <button onclick="addMember()">Add Member</button>
            </div>
        </div>

        <div class="export-import">
            <button onclick="exportData()">Export JSON</button>
            <input type="file" id="importFile" accept=".json">
            <button onclick="document.getElementById('importFile').click()">Import JSON</button>
        </div>

        <div class="members-list">
            <h3>Family Members</h3>
            <div id="membersContainer"></div>
        </div>
    </div>

    <!-- Public View -->
    <div id="publicView" class="page hidden">
        <header>
            <h1>Ibrahim Family Tree</h1>
            <button class="admin-btn" onclick="showLogin()">Admin Login</button>
        </header>
        
        <div class="family-tree">
            <div class="tree-container">
                <div id="treeVisualization"></div>
            </div>
        </div>
    </div>

    <script>// Global variables
let currentUser = null;
let familyMembers = [];

// Page navigation
function showPage(pageId) {
    document.querySelectorAll('.page').forEach(page => {
        page.classList.add('hidden');
    });
    document.getElementById(pageId).classList.remove('hidden');
}

function showLogin() {
    showPage('loginPage');
}

function showPublicView() {
    showPage('publicView');
    loadFamilyTree();
}

function logout() {
    currentUser = null;
    showPage('loginPage');
}

// Login function
function login() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    if (username === 'Benalee' && password === 'Ab@58563') {
        currentUser = { username: 'Benalee' };
        showPage('adminPanel');
        loadFamilyMembers();
    } else {
        alert('Invalid login credentials!');
    }
}

// Firebase functions
async function loadFamilyMembers() {
    try {
        const querySnapshot = await getDocs(collection(db, "familyMembers"));
        familyMembers = [];
        querySnapshot.forEach((doc) => {
            familyMembers.push({ id: doc.id, ...doc.data() });
        });
        displayMembers();
        loadFamilyTree();
    } catch (error) {
        console.error("Error loading members:", error);
    }
}

async function addMember() {
    const name = document.getElementById('memberName').value;
    const nickname = document.getElementById('memberNickname').value;
    const role = document.getElementById('memberRole').value;
    
    if (!name || !nickname) {
        alert('Please fill in all fields');
        return;
    }
    
    try {
        await addDoc(collection(db, "familyMembers"), {
            name: name,
            nickname: nickname,
            role: role,
            createdAt: new Date()
        });
        
        // Clear form
        document.getElementById('memberName').value = '';
        document.getElementById('memberNickname').value = '';
        
        // Reload members
        loadFamilyMembers();
        
        alert('Family member added successfully!');
    } catch (error) {
        console.error("Error adding member:", error);
        alert('Error adding family member');
    }
}

async function deleteMember(memberId) {
    if (confirm('Are you sure you want to delete this family member?')) {
        try {
            await deleteDoc(doc(db, "familyMembers", memberId));
            loadFamilyMembers();
        } catch (error) {
            console.error("Error deleting member:", error);
        }
    }
}

function displayMembers() {
    const container = document.getElementById('membersContainer');
    container.innerHTML = '';
    
    familyMembers.forEach(member => {
        const memberCard = document.createElement('div');
        memberCard.className = 'member-card';
        memberCard.innerHTML = `
            <div class="member-info">
                <h4>${member.name}</h4>
                <p><strong>Role:</strong> ${member.role} | <strong>Nickname:</strong> ${member.nickname}</p>
            </div>
            <div class="member-actions">
                <button class="edit-btn" onclick="editMember('${member.id}')">Edit</button>
                <button onclick="deleteMember('${member.id}')">Delete</button>
            </div>
        `;
        container.appendChild(memberCard);
    });
}

function loadFamilyTree() {
    const treeContainer = document.getElementById('treeVisualization');
    treeContainer.innerHTML = '';
    
    if (familyMembers.length === 0) {
        treeContainer.innerHTML = '<p style="text-align: center; color: #666;">No family members added yet.</p>';
        return;
    }
    
    const treeDiv = document.createElement('div');
    treeDiv.className = 'tree-horizontal';
    
    // Find ancestor (or use first member as default)
    const ancestor = familyMembers.find(m => m.role === 'ancestor') || familyMembers[0];
    
    // Create ancestor box
    const ancestorBox = document.createElement('div');
    ancestorBox.className = 'ancestor-box';
    ancestorBox.innerHTML = `
        <h3>${ancestor.name}</h3>
        <div class="role">${ancestor.role}</div>
        <div class="nickname">${ancestor.nickname}</div>
    `;
    treeDiv.appendChild(ancestorBox);
    
    // Create boxes for other members
    familyMembers.forEach(member => {
        if (member.id !== ancestor.id) {
            const memberBox = document.createElement('div');
            memberBox.className = 'member-box';
            memberBox.innerHTML = `
                <h4>${member.name}</h4>
                <div class="role">${member.role}</div>
                <div class="nickname">${member.nickname}</div>
            `;
            treeDiv.appendChild(memberBox);
        }
    });
    
    treeContainer.appendChild(treeDiv);
}

function editMember(memberId) {
    const member = familyMembers.find(m => m.id === memberId);
    if (member) {
        const newName = prompt('Enter new name:', member.name);
        const newNickname = prompt('Enter new nickname:', member.nickname);
        const newRole = prompt('Enter new role:', member.role);
        
        if (newName && newNickname && newRole) {
            // For now, we'll delete and recreate (Firestore requires updateDoc for proper editing)
            deleteMember(memberId);
            // In a real app, you'd use updateDoc here
            setTimeout(() => {
                alert('Edit functionality requires updateDoc. For now, please delete and readd the member.');
            }, 100);
        }
    }
}

function exportData() {
    const dataStr = JSON.stringify(familyMembers, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'family-tree-data.json';
    link.click();
    URL.revokeObjectURL(url);
}

function importData(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const importedData = JSON.parse(e.target.result);
            alert(`Found ${importedData.length} members in import file. Manual import required.`);
            // Note: Full import would require batch write to Firestore
        } catch (error) {
            alert('Error reading import file');
        }
    };
    reader.readAsText(file);
}

// Real-time listener for family members
function setupRealTimeListener() {
    onSnapshot(collection(db, "familyMembers"), (snapshot) => {
        familyMembers = [];
        snapshot.forEach((doc) => {
            familyMembers.push({ id: doc.id, ...doc.data() });
        });
        
        if (currentUser) {
            displayMembers();
        }
        loadFamilyTree();
    });
}

// Initialize the app
document.addEventListener('DOMContentLoaded', function() {
    showPage('loginPage');
    setupRealTimeListener();
    
    // Set up import file change listener
    document.getElementById('importFile').addEventListener('change', importData);
});</script>
</body>
</html>